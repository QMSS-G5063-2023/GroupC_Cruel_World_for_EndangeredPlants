---
title: "Final Project"
author: "Vansh Murad Kalia"
date: "2023-04-26"
output: html_document
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}

#install.packages("ggmap")
#install.packages("stringr")
#install.packages("viridis")

library(ggplot2)
library(dplyr)
library(tidyverse)
library(ggmap)


data <- read.csv("IUCN_final.csv")

data <- data.frame(data)

data <- data[c(1:51)]

data_cleaned <- data%>%
  filter(year >= 2005)

glimpse(data_cleaned)
```




Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r plot1}




```


```{r 2}



```


```{r 3}
library(gganimate)

boolColors <- as.character(c("EX"="#BD0026", "CR"="#F03B20", "EN" = "#FD8D3C","VU" = "#FECC5C", "NT" = "#FFFFB2"))
boolScale <- scale_colour_manual(name="iucn_category", values=boolColors)


p <- ggplot() +
  geom_polygon(data = us, aes(x = long, y = lat)) + 
  xlim(-130,-60) +
  geom_point(data = data_cleaned, aes(x = decimalLongitude, y = decimalLatitude, group = year,
                                      color = iucn_category), size = 0.25, breaks = c("EX", "CR", "EN","VU","NT"), values=c("#BD0026", "#F03B20", "#FD8D3C","#FECC5C","#FFFFB2" )) + boolScale +
                    scale_color_manual(name = "IUCN Category", 
                     values = pal, 
                     guide = guide_legend(override.aes = list(size = 5))) +
  coord_fixed() +
  theme_void() +
  transition_time(year) +
  ease_aes('linear') +
  labs(title = "Years 2000-2022")

p

anim <- animate(p)

anim_save("animated_chart.gif", anim)

```


```{r 4}

species <- data_cleaned %>%
  group_by(species)%>%
  count(species)

species <- species %>%
  arrange(desc(n))
species

#install.packages('dotenv')
library(dotenv)
library(jsonlite)
library(tidyverse)
library(lubridate)


# Set your API key and endpoint
api = "oGuqVbtof8x1n86bcIaRanwuFsgm6Hpd"

library(jsonlite)
#################################################################################
####            function - search news article with API                      ####
nytime = function (keyword,begin_year,end_year) {
  searchQ = URLencode(keyword)
  url = paste('http://api.nytimes.com/svc/search/v2/articlesearch.json?q=',searchQ,
              '&begin_date=',begin_year,'0101&end_date=',end_year,'1231&api-key=',api,sep="")
  #get the total number of search results
  initialsearch = fromJSON(url,flatten = T)
  maxPages = round((initialsearch$response$meta$hits / 10)-1)
  
  #try with the max page limit at 10
  maxPages = ifelse(maxPages >= 99, 99, maxPages)
  
  #creat a empty data frame
  df = data.frame(id=as.numeric(),created_time=character(),snippet=character(),
                  headline=character())
  
  #save search results into data frame
  for(i in 0:maxPages){
    #get the search results of each page
    nytSearch = fromJSON(paste0(url, "&page=", i), flatten = T) 
    temp = data.frame(id=1:nrow(nytSearch$response$docs),
                      created_time = nytSearch$response$docs$pub_date,
                      snippet = nytSearch$response$docs$snippet,
                      headline = nytSearch$response$docs$headline.main)
    df=rbind(df,temp)
    Sys.sleep(12) #sleep for 12 second
  }
  return(df)
}


japanese_zelkova = nytime('\"japanese zelkova\"',2005,2022)
green_ash = nytime('\"green ash\"',2005,2022)
ginkgo_2 = nytime('\"ginkgo \"',2005,2022)
eastern_hemlock = nytime('\"eastern hemlock\"',2005,2022)
american_elm = nytime('\"american elm\"',2005,2022)


```

```{r 6}
library(lubridate)

# Create a sample dataframe with a datetime column

# Extract the year from the datetime column and store it in a new column
japanese_zelkova$year <- substr(japanese_zelkova$created_time, 1, 4)
japanese_zelkova$scientific_name <- "Japanese Zelkova"

green_ash$year <- substr(green_ash$created_time, 1, 4)
green_ash$scientific_name <- "Green Ash"

ginkgo_2$year <- substr(ginkgo_2$created_time, 1, 4)
ginkgo_2$scientific_name <- "Ginkgo"

eastern_hemlock$year <- substr(eastern_hemlock$created_time, 1, 4)
eastern_hemlock$scientific_name <- "Eastern Hemlock"

american_elm$year <- substr(american_elm$created_time, 1, 4)
american_elm$scientific_name <- "American Elm"

NLP <- rbind(japanese_zelkova, green_ash, ginkgo_2, eastern_hemlock, american_elm)

NLP_cleaned <- NLP %>%
  group_by(year, scientific_name)%>%
  count()

NLP_cleaned



```


```{r 5}

library(ggplot2)

NLP_cleaned$year = as.numeric(as.character(NLP_cleaned$year))

chart1 <- ggplot(data = NLP_cleaned) +
  geom_line(aes(x = year, y = n, colour = scientific_name, group = scientific_name)) + geom_smooth(aes(x = year, y = n), method = lm) + labs( x = 'Year', y = "Total Number of Article Mentions", color = "Scientific Name") + theme_minimal() + ggtitle("Yearly mentions of top 5 observed endangered species in NY Times") + theme(plot.title = element_text(size = 10, face = "bold")) +     scale_x_continuous(breaks=seq(2000, 2022, 5)) + ggeasy::easy_center_title()

chart1


```


```{r 8, echo = FALSE}






```